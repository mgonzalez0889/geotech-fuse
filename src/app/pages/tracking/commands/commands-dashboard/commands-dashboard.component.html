<div class="flex flex-col flex-auto w-full">
  <div class="flex flex-wrap w-full mx-auto p-6">
    <!--Title-->
    <div class="relative flex flex-col flex-auto p-4 bg-card rounded-2xl shadow overflow-hidden">
      <div class="flex items-center justify-between w-full">
        <div>
          <h2 class="text-3xl font-semibold tracking-tight leading-8">{{'commands.titlePage' | transloco}}</h2>
        </div>
        <div class="hidden sm:inline-flex justify-end">
          <div
            class="mx-2 text-center px-4 py-1 rounded-md bg-blue-200 text-blue-800 dark:bg-blue-600 dark:text-blue-50">
            <div class="text-lg font-bold">{{pending}}</div>
            <p class="text-sm">{{'commands.pendingStatus' | transloco}}</p>
          </div>
          <div
            class="mx-2 text-center px-4 py-1 rounded-md bg-green-200  text-green-800 dark:bg-green-600 dark:text-green-50">
            <div class="text-lg font-bold">{{send}}</div>
            <p class="text-sm">{{'commands.stateSent' | transloco}}</p>
          </div>
          <div class="mx-2 text-center px-4 py-1 rounded-md bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50">
            <div class="text-lg font-bold">{{expired}}</div>
            <p class="text-sm">{{'commands.statusExpired' | transloco}}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="flex flex-wrap w-full py-6">
      <div class="w-full md:w-3/5 bg-card shadow rounded-2xl overflow-hidden">
        <div class="flex flex-col flex-auto ">
          <div class="items-center pl-4 pr-6 py-3 md:pl-6 border-b">
            <div class="flex flex-col flex-auto my-3">
              <div class="flex items-center">
                <div class="mr-4 text-2xl font-medium tracking-tight leading-6 truncate">
                  {{'commands.subtitlePage' | transloco}}
                </div>
                <div class="flex items-center justify-center pl-2">
                  <mat-icon>keyboard_command_key</mat-icon>
                </div>
              </div>
            </div>
            <div class="flex items-center my-3">
              <div class="flex border-2 rounded-full p-2">
                <input #input matInput [placeholder]="'search' | transloco" (keyup)="filterTable($event)">
                <mat-icon class="icon-size-5" matSuffix svgIcon="heroicons_outline:search"></mat-icon>
              </div>
              <div class="flex border-2 rounded-full p-2 cursor-pointer w-52  ml-3" (click)="picker.open()">
                <div>
                  <mat-date-range-input [rangePicker]="picker">
                    <input matStartDate [(ngModel)]="initialDate" [placeholder]="'dateInit' | transloco">
                    <input matEndDate [(ngModel)]="finalDate" [placeholder]="'dateEnd' | transloco">
                  </mat-date-range-input>
                  <mat-date-range-picker #picker>
                    <mat-datepicker-actions>
                      <button mat-button matDatepickerCancel>{{'buttons.buttonCancel' | transloco}}</button>
                      <button mat-raised-button [color]="'accent'" matDatepickerApply
                        (click)="getSentCommands()">{{'search' | transloco}}</button>
                    </mat-datepicker-actions>
                  </mat-date-range-picker>
                </div>
                <mat-icon class="icon-size-5" matSuffix svgIcon="feather:calendar">
                </mat-icon>
              </div>
            </div>
          </div>
        </div>
        <div class="overflow-x-auto">
          <mat-paginator [pageSizeOptions]="[10]" aria-label="Select page of users">
          </mat-paginator>
          <table mat-table [dataSource]="dataCommandsSent" matSort class="w-full">
            <!-- plate Column -->
            <ng-container matColumnDef="plate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'commands.tablePage.plate' | transloco}} </th>
              <td mat-cell *matCellDef="let row">
                <span class="pr-6 whitespace-nowrap">
                  {{row.plate}}</span>
              </td>
            </ng-container>
            <!-- date_sent Column -->
            <ng-container matColumnDef="date_sent">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{'commands.tablePage.dateOfShipment' | transloco}}
              </th>
              <td mat-cell *matCellDef="let row"> <span class="pr-6 whitespace-nowrap">
                  {{row.date_send | date: 'dd/MM/yyyy hh:mm:ss'
                  }} </span></td>
            </ng-container>
            <!-- type_command Column -->
            <ng-container matColumnDef="type_command">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{'commands.tablePage.commandType' | transloco}}
              </th>
              <td mat-cell *matCellDef="let row"> <span class="pr-6 whitespace-nowrap">
                  {{row.name_command}} </span> </td>
            </ng-container>
            <!-- user Column -->
            <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{'commands.tablePage.user' | transloco}}
              </th>
              <td mat-cell *matCellDef="let row"> <span class="pr-6 whitespace-nowrap">
                  {{row.user_sent}} </span></td>
            </ng-container>
            <!-- state Column -->
            <ng-component matColumnDef="state">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{'commands.tablePage.state' | transloco}}
              </th>
              <td mat-cell *matCellDef="let row">
                <span
                  class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase leading-relaxed whitespace-nowrap"
                  [ngClass]="{'bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50': row.state === 'EXPIRADO',
                              'bg-green-200 text-green-800 dark:bg-green-600 dark:text-green-50': row.state === 'CONFIRMADO',
                              'bg-blue-200 text-blue-800 dark:bg-blue-600 dark:text-blue-50': row.state === 'PENDIENTE'}">
                              <span *ngIf="row.state === 'EXPIRADO'">{{'commands.commandStatus.commandExpired' | transloco}}</span>
                              <span *ngIf="row.state === 'CONFIRMADO'">{{'commands.commandStatus.commandcConfirmed' | transloco}}</span>
                              <span *ngIf="row.state === 'PENDIENTE'">{{'commands.commandStatus.commandPending' | transloco}}</span>
                            </span>
                
              </td>
            </ng-component>
            <!-- boton Column -->
            <ng-container matColumnDef="resend">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row">
                <button [matTooltip]="'commands.tablePage.resendCommand' | transloco" class="leading-relaxed whitespace-nowrap fuse-mat-button-rounded"
                  mat-flat-button (click)="resendCommand(row.plate,row.typecommand_id)">
                  <mat-icon class="icon-size-6">refresh</mat-icon>
                </button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="columnsCommands"></tr>
            <tr mat-row *matRowDef="let row; columns: columnsCommands;"></tr>
            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="6">
                {{'commands.tablePage.matNoDataRow' | transloco }}{{input.value}}
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="w-full md:w-2/5 pl-6">
        <div class="bg-card shadow rounded-2xl overflow-hidden  md:pt-6">
          <div class="mr-4 p-6 text-2xl font-medium tracking-tight leading-6 truncate"> 
            {{'commands.formPage.titlePage' | transloco}}
          </div>
          <mat-tab-group [animationDuration]="'0'" (selectedTabChange)="typeOfSelection($event)">
            <!--Tab Vehiculos-->
            <mat-tab [label]="'commands.tabPage.vehicle' | transloco">
              <div class="flex border-2 rounded-full p-2 overflow-hidden">
                <input matInput [placeholder]="'commands.formPage.searchVehicle' | transloco" #searchMobile [(ngModel)]="searchPlate">
                <mat-icon class="icon-size-5" matSuffix svgIcon="heroicons_outline:search">
                </mat-icon>
              </div>
              <mat-selection-list class="h-80 ">
                <mat-checkbox *ngIf="!searchPlate" checkboxPosition="before" (change)="setAll($event.checked,'mobiles')"
                  [indeterminate]="someComplete('mobiles')" [selected]="allSelectedMobiles">
                  {{'commands.formPage.checkboxSelectAll' | transloco}}
                </mat-checkbox>
                <mat-list-option checkboxPosition="before"
                  *ngFor="let mobile of mobiles | pipeFilterPlate: searchMobile.value" [selected]="mobile.selected"
                  (click)="mobile.selected = !mobile.selected;" [value]="mobile.plate">
                  <span>{{mobile.plate}}</span>
                </mat-list-option>
              </mat-selection-list>
            </mat-tab>
            <!--Tab Flotas-->
            <mat-tab [label]="'commands.tabPage.fleet' | transloco">
              <div class="flex border-2 rounded-full p-2">
                <input matInput 
                [placeholder]="'commands.formPage.fleetSearch' | transloco" #searchFleet [(ngModel)]="searchFleets">
                <mat-icon class="icon-size-5" matSuffix svgIcon="heroicons_outline:search">
                </mat-icon>
              </div>
              <mat-selection-list class="h-80">
                <mat-checkbox *ngIf="!searchFleets" checkboxPosition="before" (change)="setAll($event.checked,'fleets')"
                  [indeterminate]="someComplete('fleets')" [selected]="allSelectedFleets">
                  {{'commands.formPage.checkboxSelectAll' | transloco}}
                </mat-checkbox>
                <mat-list-option checkboxPosition="before"
                  *ngFor="let fleet of fleets | pipeFilterFleet: searchFleet.value" [value]="fleet.id"
                  (click)="fleet.selected = !fleet.selected;" [selected]="fleet.selected">
                  <span>{{fleet.name}}</span>
                </mat-list-option>
              </mat-selection-list>
            </mat-tab>
          </mat-tab-group>
          <div class="p-7 overflow-hidden">
            <div class="mr-4 text-2xl font-medium tracking-tight leading-6 truncate">
              {{'commands.formPage.commandSelection' | transloco}}
            </div>
            <div class="pt-3">
              <mat-form-field class="w-full">
                <mat-label>{{'commands.titlePage' | transloco}}</mat-label>
                <mat-select [(ngModel)]="selectedTypeCommand">
                  <mat-option *ngFor="let command of typeCommands" [value]="command.id">
                    {{command.description_command}}</mat-option>
                </mat-select>
              </mat-form-field>
              <div class="flex justify-end">
                <button class="fuse-mat-button-rounded" mat-flat-button [color]="'accent'" (click)="sentCommands()"
                  [disabled]="!selectedTypeCommand">
                  <mat-icon *ngIf="!show" class="icon-size-5">send</mat-icon>
                  <span *ngIf="!show" class="ml-2">
                    {{'commands.formPage.sendCommandButton' | transloco}}
                  </span>
                  <mat-progress-spinner *ngIf="show" [diameter]="24" [mode]="'indeterminate'">
                  </mat-progress-spinner>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>