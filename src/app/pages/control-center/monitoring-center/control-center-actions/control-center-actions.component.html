<div class="flex flex-col w-full pl-0 md:pl-6">
    <div class="bg-card shadow rounded-2xl min-h-240">
        <div [hidden]="isAttended">
            <div class="flex items-center justify-end pt-1 pr-1">
                <button mat-icon-button [matTooltip]="'Cerrar'" (click)="closeMenu()">
                    <mat-icon class="text-gray-400" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                </button>
            </div>
            <div class="px-6">
                <div #map id="map" class="h-64 rounded-2xl">
                </div>
            </div>
            <div class="px-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 border-b py-3">
                    <div class="flex">
                        <div class="text-2xl font-semibold tracking-tight leading-6 truncate">
                            Seguimiento
                        </div>
                    </div>
                    <div class="flex text-center px-4 py-1 rounded-md bg-gray-200">
                        <span class="text-base font-normal">Placa:</span>
                        <span class="text-base font-semibold pl-3">{{selectedAlarm['plate']}}</span>
                        <span class="text-base font-semibold" *ngIf="selectedAlarm['code']"> -
                            {{selectedAlarm['code']}}</span>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            Cliente:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6">
                            {{selectedAlarm['owner_name']}}
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            Direccion:
                        </div>
                        <div class="break-all leading-6 text-base font-semibold tracking-tight">
                            <a class="pr-6" [matTooltip]="'Ver en el  mapa'"
                                href="https://maps.google.com/?q={{selectedAlarm['x']}},{{selectedAlarm['y']}}"
                                target="_blank">
                                <mat-icon class="icon-size-4">open_in_new</mat-icon>{{selectedAlarm['address']}}
                            </a>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            Alarma:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6 ">
                            {{selectedAlarm['event_name']}}
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            Fecha de generación:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6">
                            {{selectedAlarm['date_entry'] | date: 'dd/MM/yyyy hh:mm:ss'}}

                        </div>
                    </div>
                </div>
                <!--Title-->
                <div class="border-t py-3 flex justify-between">
                    <div class="p-2">
                        <h2 class="text-2xl font-semibold tracking-tight leading-6">Reporte de atencion</h2>
                    </div>
                    <div class="flex border-2 rounded-full p-2 cursor-pointer w-52  ml-3" (click)="picker.open()">
                        <div>
                            <mat-date-range-input [rangePicker]="picker">
                                <input matStartDate [(ngModel)]="initialDate" placeholder="Fecha inicial">
                                <input matEndDate [(ngModel)]="finalDate" placeholder="Fecha Final">
                            </mat-date-range-input>
                            <mat-date-range-picker #picker>
                                <mat-datepicker-actions>
                                    <button mat-button matDatepickerCancel>Cancelar</button>
                                    <button mat-raised-button [color]="'accent'" matDatepickerApply
                                        (click)="getReportAlarmsAttens()">Buscar</button>
                                </mat-datepicker-actions>
                            </mat-date-range-picker>
                        </div>
                        <mat-icon class="icon-size-5" matSuffix svgIcon="feather:calendar">
                        </mat-icon>
                    </div>
                </div>

                    <!-- Tabla contacto-->
                    <div class="flex flex-col flex-auto overflow-y-auto">
                        <table mat-table [dataSource]="dataTableAttendedAlarms" matSort>
                            <!-- plate Column -->
                            <ng-container matColumnDef="plate">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Placa </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- alarm Column -->
                            <ng-container matColumnDef="alarm">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Alarma</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- address Column -->
                            <ng-container matColumnDef="address">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Dirección</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- date_entry Column -->
                            <ng-container matColumnDef="date_entry">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha de ingreso </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- date_entry Column -->
                            <ng-container matColumnDef="attention_date">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha de atención</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- reaction_time Column -->
                            <ng-container matColumnDef="reaction_time">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Tiempo Reacción </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- time_attention Column -->
                            <ng-container matColumnDef="time_attention">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Tiempo de atención</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- user Column -->
                            <ng-container matColumnDef="user">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Usuario </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <!-- action Column -->
                            <ng-container matColumnDef="action">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Atención</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.id}} </span>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="columnsAttendedAlarms"></tr>
                            <tr mat-row *matRowDef="let row; columns: columnsAttendedAlarms;">
                            </tr>
                        </table>
                        <mat-paginator class="bg-gray-200" [pageSizeOptions]="[5,10,15]"
                            aria-label="Select page of users">
                        </mat-paginator>
                    </div>
            </div>
        </div>
        <div [hidden]="!isAttended">
            <div class="px-6 py-3">
                <div>
                    <span class="text-base font-semibold">Atención de alarmas </span>
                    <span class="text-lg font-bold">| {{selectedAlarm['plate']}}</span>
                </div>
                <form [formGroup]="attendedAlarmsForm">
                    <div class="flex flex-col pt-3">
                        <mat-form-field>
                            <mat-label>Estado de atención</mat-label>
                            <mat-select required [formControlName]="'stateAlarmAttend'">
                                <mat-option *ngFor="let status of statusAttends" [value]="status.id"
                                    (click)="validStateAlarmAttend(status.id)">
                                    {{status.description}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col" *ngIf="showPostponeAlarm">
                        <mat-form-field [color]="'accent'" appearance="fill" class="example-form-field">
                            <mat-label>Generar nuevamente la alarma</mat-label>
                            <input [min]="minDate" matInput [matDatepicker]="datepicker"
                                [formControlName]="'postponeAlarmDate'" [required]="showPostponeAlarm">
                            <mat-datepicker-toggle matSuffix [for]="datepicker"></mat-datepicker-toggle>
                            <mat-datepicker #datepicker>
                                <mat-datepicker-actions>
                                    <div class="flex justify-center">
                                        <input class="w-26 p-3" type="time" matInput
                                            [formControlName]="'postponeAlarmHour'" [required]="showPostponeAlarm">
                                        <button mat-raised-button [color]="'accent'" matDatepickerApply>Ok</button>
                                    </div>
                                </mat-datepicker-actions>
                            </mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col">
                        <mat-form-field>
                            <mat-label>Causal de la alarma</mat-label>
                            <mat-select [formControlName]="'causalAlarmAttend'" required>
                                <mat-option *ngFor="let status of causalAttends" [value]="status.id">
                                    {{status.description}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col">
                        <mat-form-field class="fuse-mat-textarea fuse-mat-no-subscript w-full">
                            <mat-label>Sucesos</mat-label>
                            <textarea [formControlName]="'description'" placeholder="Agregar detalles" required matInput
                                matTextareaAutosize></textarea>
                        </mat-form-field>
                    </div>
                    <div class="flex items-center pt-3">
                        <button class="ml-auto" mat-button [matTooltip]="'Cancelar'" (click)="onCancel()">
                            Cancelar
                        </button>
                        <!-- Atender alarma -->
                        <button class="ml-2" mat-flat-button [color]="'accent'" [disabled]="attendedAlarmsForm.invalid"
                            [matTooltip]="'Atender'" (click)="attendAlarm()">
                            Atender
                        </button>
                    </div>
                </form>
            </div>
            <div class="px-6 ">
                <!--Title-->
                <div class="border-t p-3 flex justify-between">
                    <div>
                        <h2 class="text-2xl font-semibold tracking-tight leading-6">Contactos
                        </h2>
                        <div class="text-base font-semibold text-secondary">
                            <ng-container *ngIf="contactsCount > 0">
                                {{contactsCount}}
                            </ng-container>
                            {{contactsCount | i18nPlural: {
                            '=0' : 'Sin contactos',
                            '=1' : 'Contacto',
                            'other': 'Contactos'
                            } }}
                        </div>
                    </div>

                    <button class="ml-2 circ" mat-mini-fab [color]="'accent'" [matTooltip]="'Nuevo contacto'"
                        (click)="newContact()">
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
                <!-- Tabla contacto-->
                <div class="flex flex-col flex-auto overflow-y-auto">
                    <table mat-table [dataSource]="dataTableContactsControlCenter" matSort>
                        <!-- full_name Column -->
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="pr-6 whitespace-nowrap">
                                    {{row.full_name}} </span>
                            </td>
                        </ng-container>
                        <!-- identification Column -->
                        <ng-container matColumnDef="identification">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Identificación </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="pr-6 whitespace-nowrap">
                                    {{row.identification}} </span>
                            </td>
                        </ng-container>
                        <!-- phone Column -->
                        <ng-container matColumnDef="cellPhone">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Celular</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="pr-6 whitespace-nowrap">
                                    {{row.phone}} </span>
                            </td>
                        </ng-container>
                        <!-- full_name Column -->
                        <ng-container matColumnDef="type_contacs">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo de contacto </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="pr-6 whitespace-nowrap">
                                    {{row.type_contact_description}} </span>
                            </td>
                        </ng-container>

                        <!-- email Column -->
                        <ng-component matColumnDef="email">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Correo electrónico </th>
                            <td mat-cell *matCellDef="let row">
                                <a class="hover:underline text-primary-500 pr-6 whitespace-nowrap"
                                    [href]="'mailto:' + row.email" target="_blank">
                                    {{row.email}}
                                </a>
                            </td>
                        </ng-component>
                        <!-- description Column -->
                        <ng-container matColumnDef="description">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Observaciones </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="pr-6">
                                    {{row.description}} </span>
                            </td>
                        </ng-container>
                        <!-- actions Column -->
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                            <td mat-cell *matCellDef="let row">
                                <button mat-icon-button [matMenuTriggerFor]="menu">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="editContact(row.id)">
                                        <mat-icon>edit</mat-icon>
                                        <span>Editar</span>
                                    </button>
                                    <button mat-menu-item (click)="deleteContact(row.id)">
                                        <mat-icon>delete</mat-icon>
                                        <span>Eliminar</span>
                                    </button>
                                </mat-menu>
                            </td>
                        </ng-container>


                        <tr mat-header-row *matHeaderRowDef="columnsContactsControlCenter"></tr>
                        <tr mat-row *matRowDef="let row; columns: columnsContactsControlCenter;">
                        </tr>
                        <!-- Fila que se muestra cuando no hay datos coincidentes.. -->
                        <!-- <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">No hay datos que coincidan con la busqueda:
                                "{{input.value}}"
                            </td>
                        </tr> -->
                    </table>
                    <mat-paginator class="bg-gray-200" [pageSizeOptions]="[5,10,15]" aria-label="Select page of users">
                    </mat-paginator>
                </div>
            </div>

        </div>
    </div>
</div>
