<div class="flex flex-col w-full pl-0 md:pl-6">
    <div class="bg-card shadow rounded-2xl min-h-240">
        <div [hidden]="isAttended">
            <div class="flex items-center justify-end pt-1 pr-1">
                <button mat-icon-button [matTooltip]="'buttons.buttonClose' | transloco" (click)="closeMenu()">
                    <mat-icon class="text-gray-400" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                </button>
            </div>
            <div class="px-6">
                <div #map id="map" class="h-64 rounded-2xl">
                </div>
            </div>
            <div class="px-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 border-b py-3">
                    <div class="flex">
                        <div class="text-2xl font-semibold tracking-tight leading-6 truncate">
                            {{'monitoringCenter.formPage.followUp' | transloco}}
                        </div>
                    </div>
                    <div class="flex text-center px-4 py-1 rounded-md bg-gray-200">
                        <span class="text-base font-normal">{{'monitoringCenter.table.plate' | transloco}}:</span>
                        <span class="text-base font-semibold pl-3">{{selectedAlarm['plate']}}</span>
                        <span class="text-base font-semibold" *ngIf="selectedAlarm['code']"> -
                            {{selectedAlarm['code']}}</span>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            {{'monitoringCenter.formPage.customer' | transloco}}:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6">
                            {{selectedAlarm['owner_name']}}
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            {{'monitoringCenter.formPage.address' | transloco}}:
                        </div>
                        <div class="break-all leading-6 text-base font-semibold tracking-tight">
                            <a class="pr-6" [matTooltip]="'monitoringCenter.table.seeOnTheMap' | transloco"
                                href="https://maps.google.com/?q={{selectedAlarm['x']}},{{selectedAlarm['y']}}"
                                target="_blank">
                                <mat-icon class="icon-size-4">open_in_new</mat-icon>{{selectedAlarm['address']}}
                            </a>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            {{'monitoringCenter.formPage.alarm' | transloco}}:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6 ">
                            {{selectedAlarm['event_name']}}
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div>
                            {{'monitoringCenter.formPage.dateOfGeneration' | transloco}}:
                        </div>
                        <div class="break-all text-base font-semibold tracking-tight leading-6">
                            {{selectedAlarm['date_entry'] | date: 'dd/MM/yyyy hh:mm:ss'}}

                        </div>
                    </div>
                </div>
                <!--Title-->
                <div class="border-t py-3 flex justify-between">
                    <div class="p-2">
                        <h2 class="text-2xl font-semibold tracking-tight leading-6">{{'monitoringCenter.formPage.attentionReport' | transloco}}</h2>
                    </div>
                    <div class="flex border-2 rounded-full p-2 cursor-pointer w-52  ml-3" (click)="picker.open()">
                        <div>
                            <mat-date-range-input [rangePicker]="picker">
                                <input matStartDate [(ngModel)]="initialDate" 
                                [placeholder]="'monitoringCenter.formPage.initialDate' | transloco">
                                <input matEndDate [(ngModel)]="finalDate" 
                                [placeholder]="'monitoringCenter.formPage.finalDate' | transloco">
                            </mat-date-range-input>
                            <mat-date-range-picker #picker>
                                <mat-datepicker-actions>
                                    <button mat-button matDatepickerCancel>{{'buttons.buttonCancel' | transloco}}</button>
                                    <button mat-raised-button [color]="'accent'" matDatepickerApply
                                        (click)="getReportAlarmsAttens()">{{'search' | transloco}}</button>
                                </mat-datepicker-actions>
                            </mat-date-range-picker>
                        </div>
                        <mat-icon class="icon-size-5" matSuffix svgIcon="feather:calendar">
                        </mat-icon>
                    </div>
                </div>
                <div [hidden]="this.dataTableAttendedAlarms?.filteredData.length"
                    class="pt-3 w-full h-full items-center justify-center">
                    <div class="flex items-center justify-center">
                        <div class="text-base font-semibold text-secondary">{{'table.warningDescription' | transloco}}
                        </div>
                    </div>
                </div>
                <div [hidden]="!this.dataTableAttendedAlarms?.filteredData.length">
                    <!-- Tabla contacto-->
                    <div class="flex flex-col flex-auto overflow-y-auto">
                        <table matSort #sortAttendedAlarms='matSort' mat-table [dataSource]="dataTableAttendedAlarms">
                            <!-- plate Column -->
                            <ng-container matColumnDef="plate">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.table.plate' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.plate}} </span>
                                </td>
                            </ng-container>
                            <!-- alarm Column -->
                            <ng-container matColumnDef="alarm">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.alarm' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.causal_description}} </span>
                                </td>
                            </ng-container>
                            <!-- date_entry_alarm Column -->
                            <ng-container matColumnDef="date_entry_alarm">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.dateOfEntry' | transloco}} </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.date_entry_alarm | date: 'dd/MM/yyyy hh:mm:ss'}}
                                    </span>
                                </td>
                            </ng-container>
                            <!-- date_init_alarm Column -->
                            <ng-container matColumnDef="date_init_alarm">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.startDateOfAttention' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.date_init_alarm | date: 'dd/MM/yyyy hh:mm:ss'}} </span>
                                </td>
                            </ng-container>
                            <!-- reaction_time Column -->
                            <ng-container matColumnDef="reaction_time">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.reactionTime' | transloco}} (HH:mm:ss)</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.reaction_time}}
                                    </span>
                                </td>
                            </ng-container>
                            <!-- date_end_alarm Column -->
                            <ng-container matColumnDef="date_end_alarm">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.dateOfAttention' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.date_end_alarm | date: 'dd/MM/yyyy hh:mm:ss'}} </span>
                                </td>
                            </ng-container>
                            <!-- time_attention Column -->
                            <ng-container matColumnDef="time_attention">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.timeOfAttention' | transloco}} (HH:mm:ss)
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.attention_time}} </span>
                                </td>
                            </ng-container>
                            <!-- user Column -->
                            <ng-container matColumnDef="user">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.user' | transloco}}</th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.controlcenter_user_name}} </span>
                                </td>
                            </ng-container>
                            <!-- action Column -->
                            <ng-container matColumnDef="action">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPage.table.attention' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.description}} </span>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="columnsAttendedAlarms"></tr>
                            <tr mat-row *matRowDef="let row; columns: columnsAttendedAlarms;">
                            </tr>
                        </table>
                        <mat-paginator #paginatorAttendedAlarms class="bg-gray-200" [pageSizeOptions]="[5,10,15]"
                            aria-label="Select page of users">
                        </mat-paginator>
                    </div>
                </div>
            </div>
        </div>
        <div [hidden]="!isAttended">
            <div class="px-6 py-3">
                <div>
                    <span class="text-base font-semibold">
                        {{'monitoringCenter.tableIsAttended.alarmAttention' | transloco}}
                     </span>
                    <span class="text-lg font-bold">| {{selectedAlarm['plate']}}</span>
                </div>
                <form [formGroup]="attendedAlarmsForm">
                    <div class="flex flex-col pt-3">
                        <mat-form-field>
                            <mat-label>
                                {{'monitoringCenter.tableIsAttended.attentionStatus' | transloco}}
                            </mat-label>
                            <mat-select required [formControlName]="'stateAlarmAttend'">
                                <mat-option *ngFor="let status of statusAttends" [value]="status.id"
                                    (click)="validStateAlarmAttend(status.id)">
                                    {{status.description}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col" *ngIf="showPostponeAlarm">
                        <mat-form-field [color]="'accent'" appearance="fill" class="example-form-field">
                            <mat-label>
                                {{'monitoringCenter.tableIsAttended.generateAlarmAgain' | transloco}}
                            </mat-label>
                            <input [min]="minDate" matInput [matDatepicker]="datepicker"
                                [formControlName]="'postponeAlarmDate'" [required]="showPostponeAlarm">
                            <mat-datepicker-toggle matSuffix [for]="datepicker"></mat-datepicker-toggle>
                            <mat-datepicker #datepicker>
                                <mat-datepicker-actions>
                                    <div class="flex justify-center">
                                        <input class="w-26 p-3" type="time" matInput
                                            [formControlName]="'postponeAlarmHour'" [required]="showPostponeAlarm">
                                        <button mat-raised-button [color]="'accent'" matDatepickerApply>
                                            {{'monitoringCenter.tableIsAttended.buttonOk' | transloco}}
                                        </button>
                                    </div>
                                </mat-datepicker-actions>
                            </mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col">
                        <mat-form-field>
                            <mat-label>
                                {{'monitoringCenter.tableIsAttended.causeOfAlarm' | transloco}}
                            </mat-label>
                            <mat-select [formControlName]="'causalAlarmAttend'" required>
                                <mat-option *ngFor="let status of causalAttends" [value]="status.id">
                                    {{status.description}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col">
                        <mat-form-field class="fuse-mat-textarea fuse-mat-no-subscript w-full">
                            <mat-label>
                                {{'monitoringCenter.tableIsAttended.events' | transloco}}
                            </mat-label>
                            <textarea [formControlName]="'description'" 
                            [placeholder]="'monitoringCenter.tableIsAttended.addDetails' | transloco" required matInput
                                matTextareaAutosize></textarea>
                        </mat-form-field>
                    </div>
                    <div class="flex items-center pt-3">
                        <button class="ml-auto" mat-button [matTooltip]="'buttons.buttonCancel' | transloco" (click)="onCancel()">
                            {{'buttons.buttonCancel' | transloco}}
                        </button>
                        <!-- Atender alarma -->
                        <button class="ml-2" mat-flat-button [color]="'accent'" [disabled]="attendedAlarmsForm.invalid"
                            [matTooltip]="'monitoringCenter.tableIsAttended.buttonAttend' | transloco" (click)="attendAlarms()">
                            {{'monitoringCenter.tableIsAttended.buttonAttend' | transloco}}
                        </button>
                    </div>
                </form>
            </div>
            <div class="px-6 ">
                <!--Title-->
                <div class="border-t p-3 flex justify-between">
                    <div>
                        <h2 class="text-2xl font-semibold tracking-tight leading-6">
                            {{'monitoringCenter.formPageContacts.contacts' | transloco}}
                        </h2>
                        <div class="text-base font-semibold text-secondary">
                            <ng-container *ngIf="contactsCount > 0">
                                {{contactsCount}}
                            </ng-container>
                            {{contactsCount | i18nPlural: {
                            '=0' : 'Sin contactos',
                            '=1' : 'Contacto',
                            'other': 'Contactos'
                            } }}
                        </div>
                    </div>
                    <button class="ml-2 circ" mat-mini-fab [color]="'accent'" 
                    [matTooltip]="'monitoringCenter.formPageContacts.newContact' | transloco"
                        (click)="newContact()">
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
                <div [hidden]="contactsCount>=1" class="pt-3 w-full h-full items-center justify-center">
                    <div class="flex items-center justify-center">
                        <div class="text-base font-semibold text-secondary">
                            {{'table.warningDescription' | transloco}}
                        </div>
                    </div>
                </div>
                <div [hidden]="contactsCount<1">
                    <!-- Tabla contacto-->
                    <div class="flex flex-col flex-auto overflow-y-auto">
                        <table mat-table [dataSource]="dataTableContactsControlCenter"
                            #sortContactsControlCenter='matSort' matSort>
                            <!-- full_name Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPageContacts.name' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.full_name}} </span>
                                </td>
                            </ng-container>
                            <!-- identification Column -->
                            <ng-container matColumnDef="identification">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>                                     {{'monitoringCenter.formPageContacts.identification' | transloco}}

                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.identification}} </span>
                                </td>
                            </ng-container>
                            <!-- phone Column -->
                            <ng-container matColumnDef="cellPhone">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPageContacts.cellPhone' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.phone}} </span>
                                </td>
                            </ng-container>
                            <!-- full_name Column -->
                            <ng-container matColumnDef="type_contacs">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPageContacts.typeOfContact' | transloco}}                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6 whitespace-nowrap">
                                        {{row.type_contact_description}} </span>
                                </td>
                            </ng-container>
                            <!-- email Column -->
                            <ng-component matColumnDef="email">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                    {{'monitoringCenter.formPageContacts.email' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <a class="hover:underline text-primary-500 pr-6 whitespace-nowrap"
                                        [href]="'mailto:' + row.email" target="_blank">
                                        {{row.email}}
                                    </a>
                                </td>
                            </ng-component>
                            <!-- description Column -->
                            <ng-container matColumnDef="description">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>                                     {{'monitoringCenter.formPageContacts.observations' | transloco}}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <span class="pr-6">
                                        {{row.description}} </span>
                                </td>
                            </ng-container>
                            <!-- actions Column -->
                            <ng-container matColumnDef="actions">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                                <td mat-cell *matCellDef="let row">
                                    <button mat-icon-button [matMenuTriggerFor]="menu">
                                        <mat-icon>more_vert</mat-icon>
                                    </button>
                                    <mat-menu #menu="matMenu">
                                        <button mat-menu-item (click)="editContact(row.id)">
                                            <mat-icon>edit</mat-icon>
                                            <span>{{'buttons.buttonEdit' | transloco}}</span>
                                        </button>
                                        <button mat-menu-item (click)="deleteContacts(row.id)">
                                            <mat-icon>delete</mat-icon>
                                            <span>{{'buttons.buttonDelete' | transloco}}</span>
                                        </button>
                                    </mat-menu>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="columnsContactsControlCenter"></tr>
                            <tr mat-row *matRowDef="let row; columns: columnsContactsControlCenter;">
                            </tr>
                        </table>
                        <mat-paginator #paginatorContactsControlCenter class="bg-gray-200" [pageSizeOptions]="[5,10,15]"
                            aria-label="Select page of users">
                        </mat-paginator>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
